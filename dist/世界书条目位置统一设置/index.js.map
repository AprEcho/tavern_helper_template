{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/世界书条目位置统一设置/settings.ts","src://tavern_helper_template/src/世界书条目位置统一设置/app.vue","webpack://tavern_helper_template/src/世界书条目位置统一设置/app.vue?7378","src://tavern_helper_template/src/世界书条目位置统一设置/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { useStorage } from '@vueuse/core';\nimport { defineStore } from 'pinia';\n\ninterface Settings {\n  enabled: boolean;\n  position: WorldbookEntry['position']['type'];\n  depth: number;\n}\n\nexport const useSettingsStore = defineStore('worldbook-position-override', () => {\n  const settings = useStorage<Settings>(\n    'worldbook-position-override-settings',\n    {\n      enabled: true,\n      position: 'before_character_definition',\n      depth: 1,\n    },\n    localStorage,\n    { mergeDefaults: true },\n  );\n\n  return { settings };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, unref as _unref, vModelCheckbox as _vModelCheckbox, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, vModelSelect as _vModelSelect, vModelText as _vModelText, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = { class: \"worldbook-position-override-settings\" };\nconst _hoisted_2 = { class: \"inline-drawer\" };\nconst _hoisted_3 = { class: \"inline-drawer-content\" };\nconst _hoisted_4 = { class: \"block\" };\nconst _hoisted_5 = { class: \"block\" };\nconst _hoisted_6 = [\"disabled\"];\nconst _hoisted_7 = [\"value\"];\nconst _hoisted_8 = {\n    key: 0,\n    class: \"block\"\n};\nconst _hoisted_9 = [\"disabled\"];\nimport { useSettingsStore } from './settings';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const { settings } = useSettingsStore();\n        const positionOptions = [\n            { value: 'before_character_definition', text: '角色定义之前' },\n            { value: 'after_character_definition', text: '角色定义之后' },\n            { value: 'before_example_messages', text: '示例消息之前' },\n            { value: 'after_example_messages', text: '示例消息之后' },\n            { value: 'before_author_note', text: '作者注释之前' },\n            { value: 'after_author_note', text: '作者注释之后' },\n            { value: 'at_depth', text: '插入到指定深度' },\n        ];\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[7] || (_cache[7] = _createElementVNode(\"div\", { class: \"inline-drawer-toggle inline-drawer-header\" }, [\n                        _createElementVNode(\"b\", null, _toDisplayString(`世界书条目位置统一设置`)),\n                        _createElementVNode(\"div\", { class: \"inline-drawer-icon fa-solid fa-circle-chevron-down down\" })\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _withDirectives(_createElementVNode(\"input\", {\n                                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(settings).enabled) = $event)),\n                                type: \"checkbox\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelCheckbox, _unref(settings).enabled]\n                            ]),\n                            _cache[3] || (_cache[3] = _createElementVNode(\"label\", null, _toDisplayString(`启用统一设置`), -1 /* CACHED */))\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            _cache[4] || (_cache[4] = _createElementVNode(\"label\", { for: \"wb-pos-override-type\" }, \"插入位置: \", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"select\", {\n                                id: \"wb-pos-override-type\",\n                                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(settings).position) = $event)),\n                                class: \"text_pole\",\n                                disabled: !_unref(settings).enabled\n                            }, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(positionOptions, (opt) => {\n                                    return _createElementVNode(\"option\", {\n                                        key: opt.value,\n                                        value: opt.value\n                                    }, _toDisplayString(opt.text), 9 /* TEXT, PROPS */, _hoisted_7);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ], 8 /* PROPS */, _hoisted_6), [\n                                [_vModelSelect, _unref(settings).position]\n                            ])\n                        ]),\n                        (_unref(settings).position === 'at_depth')\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [\n                                _cache[5] || (_cache[5] = _createElementVNode(\"label\", { for: \"wb-pos-override-depth\" }, \"插入深度: \", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    id: \"wb-pos-override-depth\",\n                                    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((_unref(settings).depth) = $event)),\n                                    type: \"number\",\n                                    class: \"text_pole\",\n                                    min: \"1\",\n                                    disabled: !_unref(settings).enabled\n                                }, null, 8 /* PROPS */, _hoisted_9), [\n                                    [\n                                        _vModelText,\n                                        _unref(settings).depth,\n                                        void 0,\n                                        { number: true }\n                                    ]\n                                ])\n                            ]))\n                            : _createCommentVNode(\"v-if\", true),\n                        _cache[6] || (_cache[6] = _createElementVNode(\"hr\", { class: \"sysHR\" }, null, -1 /* CACHED */))\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createScriptIdDiv, destroyScriptIdDiv, deteleportStyle, teleportStyle } from '@/util/script';\nimport App from './app.vue';\nimport { useSettingsStore } from './settings';\nconst app = createApp(App).use(createPinia());\n$(() => {\n    const $app = createScriptIdDiv();\n    $('#extensions_settings2').append($app);\n    teleportStyle();\n    app.mount($app[0]);\n});\n$(window).on('pagehide', () => {\n    app.unmount();\n    deteleportStyle();\n    destroyScriptIdDiv();\n});\nconst positionMap = {\n    before_character_definition: 0,\n    after_character_definition: 1,\n    before_example_messages: 2,\n    after_example_messages: 3,\n    before_author_note: 4,\n    after_author_note: 5,\n    at_depth: 6,\n};\nlet cachedLores = null;\nfunction updateLorePositions(lores) {\n    const { settings } = useSettingsStore();\n    if (!settings.enabled) {\n        return;\n    }\n    const allEntries = [...lores.globalLore, ...lores.characterLore, ...lores.chatLore, ...lores.personaLore];\n    const positionValue = positionMap[settings.position];\n    for (const entry of allEntries) {\n        entry.position = positionValue;\n        if (settings.position === 'at_depth') {\n            entry.depth = settings.depth;\n        }\n    }\n}\neventOn(tavern_events.WORLDINFO_ENTRIES_LOADED, lores => {\n    cachedLores = lores;\n    updateLorePositions(lores);\n});\nconst { settings } = useSettingsStore();\nwatch(settings, () => {\n    if (cachedLores) {\n        updateLorePositions(cachedLores);\n    }\n});\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["Vue","useSettingsStore","settings","enabled","position","depth","localStorage","mergeDefaults","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","key","_hoisted_9","__name","setup","__props","positionOptions","value","text","_ctx","_cache","$event","type","for","id","disabled","opt","min","number","createApp","use","$","$app","attr","getScriptId","append","length","$div","document","clone","teleportStyle","mount","window","on","unmount","remove","positionMap","before_character_definition","after_character_definition","before_example_messages","after_example_messages","before_author_note","after_author_note","at_depth","cachedLores","updateLorePositions","lores","allEntries","globalLore","characterLore","chatLore","personaLore","positionValue","entry","eventOn","tavern_events","WORLDINFO_ENTRIES_LOADED","watch"],"ignoreList":[],"sourceRoot":""}