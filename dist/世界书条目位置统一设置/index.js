import{useStorage as e}from'https://testingcf.jsdelivr.net/npm/@vueuse/core/+esm';import{createPinia as t,defineStore as o}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';const n=Vue,r=o('worldbook-position-override',()=>({settings:e('worldbook-position-override-settings',{enabled:!0,position:'before_character_definition',depth:1},localStorage,{mergeDefaults:!0})})),i={class:'worldbook-position-override-settings'},a={class:'inline-drawer'},l={class:'inline-drawer-content'},d={class:'block'},s={class:'block'},c=['disabled'],p=['value'],u={key:0,class:'block'},m=['disabled'],v=(0,n.defineComponent)({__name:'app',setup(e){const{settings:t}=r(),o=[{value:'before_character_definition',text:'角色定义之前'},{value:'after_character_definition',text:'角色定义之后'},{value:'before_example_messages',text:'示例消息之前'},{value:'after_example_messages',text:'示例消息之后'},{value:'before_author_note',text:'作者注释之前'},{value:'after_author_note',text:'作者注释之后'},{value:'at_depth',text:'插入到指定深度'}];return(e,r)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',i,[(0,n.createElementVNode)('div',a,[r[7]||(r[7]=(0,n.createElementVNode)('div',{class:'inline-drawer-toggle inline-drawer-header'},[(0,n.createElementVNode)('b',null,(0,n.toDisplayString)('世界书条目位置统一设置')),(0,n.createElementVNode)('div',{class:'inline-drawer-icon fa-solid fa-circle-chevron-down down'})],-1)),(0,n.createElementVNode)('div',l,[(0,n.createElementVNode)('div',d,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':r[0]||(r[0]=e=>(0,n.unref)(t).enabled=e),type:'checkbox'},null,512),[[n.vModelCheckbox,(0,n.unref)(t).enabled]]),r[3]||(r[3]=(0,n.createElementVNode)('label',null,(0,n.toDisplayString)('启用统一设置'),-1))]),(0,n.createElementVNode)('div',s,[r[4]||(r[4]=(0,n.createElementVNode)('label',{for:'wb-pos-override-type'},'插入位置: ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('select',{id:'wb-pos-override-type','onUpdate:modelValue':r[1]||(r[1]=e=>(0,n.unref)(t).position=e),class:'text_pole',disabled:!(0,n.unref)(t).enabled},[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(o,e=>(0,n.createElementVNode)('option',{key:e.value,value:e.value},(0,n.toDisplayString)(e.text),9,p)),64))],8,c),[[n.vModelSelect,(0,n.unref)(t).position]])]),'at_depth'===(0,n.unref)(t).position?((0,n.openBlock)(),(0,n.createElementBlock)('div',u,[r[5]||(r[5]=(0,n.createElementVNode)('label',{for:'wb-pos-override-depth'},'插入深度: ',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{id:'wb-pos-override-depth','onUpdate:modelValue':r[2]||(r[2]=e=>(0,n.unref)(t).depth=e),type:'number',class:'text_pole',min:'1',disabled:!(0,n.unref)(t).enabled},null,8,m),[[n.vModelText,(0,n.unref)(t).depth,void 0,{number:!0}]])])):(0,n.createCommentVNode)('v-if',!0),r[6]||(r[6]=(0,n.createElementVNode)('hr',{class:'sysHR'},null,-1))])])]))}}),f=v,h=(0,n.createApp)(f).use(t());$(()=>{const e=$('<div>').attr('script_id',getScriptId());$('#extensions_settings2').append(e),function(){if($(`head > div[script_id="${getScriptId()}"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}(),h.mount(e[0])}),$(window).on('pagehide',()=>{h.unmount(),$(`head > div[script_id="${getScriptId()}"]`).remove(),$(`div[script_id="${getScriptId()}"]`).remove()});const b={before_character_definition:0,after_character_definition:1,before_example_messages:2,after_example_messages:3,before_author_note:4,after_author_note:5,at_depth:6};let g=null;function E(e){const{settings:t}=r();if(!t.enabled)return;const o=[...e.globalLore,...e.characterLore,...e.chatLore,...e.personaLore],n=b[t.position];for(const e of o)e.position=n,'at_depth'===t.position&&(e.depth=t.depth)}eventOn(tavern_events.WORLDINFO_ENTRIES_LOADED,e=>{g=e,E(e)});const{settings:w}=r();(0,n.watch)(w,()=>{g&&E(g)});
//# sourceMappingURL=index.js.map